import Foundation
import Capacitor

@objc public class GetContactByIdOptions: NSObject {
    let id: String
    var fields: [ContactField] = [.birthday, .emailAddresses, .familyName, .givenName, .jobTitle, .middleName, .namePrefix, .nameSuffix, .organizationName, .phoneNumbers, .postalAddresses, .urlAddresses]
    var includeId = true
    var includeGroupIds = false

    init(_ call: CAPPluginCall) throws {
        self.id = try GetContactByIdOptions.getIdFromCall(call)
        if let fields = call.getArray("fields") as? [String] {
            self.fields = fields.compactMap { ContactField(rawValue: $0) }
            self.includeId = fields.contains("id")
            self.includeGroupIds = fields.contains("groupIds")
        }
    }

    private static func getIdFromCall(_ call: CAPPluginCall) throws -> String {
        guard let id = call.getString("id") else {
            throw CustomError.idMissing
        }
        return id
    }
}
