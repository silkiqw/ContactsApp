package io.capawesome.capacitorjs.plugins.contacts.classes;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import com.getcapacitor.JSObject;
import io.capawesome.capacitorjs.plugins.contacts.ContactsPlugin;
import io.capawesome.capacitorjs.plugins.contacts.enums.UrlAddressType;
import org.json.JSONObject;

public class UrlAddress {

    @Nullable
    private final String label;

    @NonNull
    private final UrlAddressType type;

    @NonNull
    private final String value;

    public UrlAddress(@Nullable String label, @NonNull UrlAddressType type, @NonNull String value) {
        this.label = label;
        this.type = type;
        this.value = value;
    }

    public UrlAddress(@NonNull JSObject data) throws Exception {
        this.label = data.getString("label");
        this.type = getTypeFromJSObject(data);
        this.value = getValueFromJSObject(data);
    }

    public static UrlAddress fromJSONObject(JSONObject data) throws Exception {
        return new UrlAddress(JSObject.fromJSONObject(data));
    }

    @Nullable
    public String getLabel() {
        return label;
    }

    public int getType() {
        return type.toInt();
    }

    @NonNull
    public String getValue() {
        return value;
    }

    @NonNull
    public JSObject toJSObject() {
        JSObject result = new JSObject();
        result.put("label", label);
        result.put("type", type.toString());
        result.put("value", value);
        return result;
    }

    @NonNull
    private UrlAddressType getTypeFromJSObject(@NonNull JSObject data) throws Exception {
        String typeAsString = data.getString("type");
        if (typeAsString == null) {
            return UrlAddressType.OTHER;
        }
        UrlAddressType type = UrlAddressType.fromString(typeAsString);
        if (type == null) {
            throw new Exception(ContactsPlugin.ERROR_TYPE_INVALID);
        }
        return type;
    }

    @NonNull
    private String getValueFromJSObject(@NonNull JSObject data) throws Exception {
        String value = data.getString("value");
        if (value == null) {
            throw new Exception(ContactsPlugin.ERROR_VALUE_MISSING);
        }
        return value;
    }
}
