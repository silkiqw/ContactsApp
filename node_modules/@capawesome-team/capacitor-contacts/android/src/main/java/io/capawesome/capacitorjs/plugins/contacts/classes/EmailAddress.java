package io.capawesome.capacitorjs.plugins.contacts.classes;

import androidx.annotation.NonNull;
import androidx.annotation.Nullable;
import com.getcapacitor.JSObject;
import io.capawesome.capacitorjs.plugins.contacts.ContactsPlugin;
import io.capawesome.capacitorjs.plugins.contacts.enums.EmailAddressType;
import java.util.Objects;
import org.json.JSONObject;

public class EmailAddress {

    @Nullable
    private final Boolean isPrimary;

    @Nullable
    private final String label;

    @NonNull
    private final EmailAddressType type;

    @NonNull
    private final String value;

    public EmailAddress(@Nullable Boolean isPrimary, @Nullable String label, @NonNull EmailAddressType type, @NonNull String value) {
        this.isPrimary = Objects.requireNonNullElse(isPrimary, false);
        this.label = label;
        this.type = type;
        this.value = value;
    }

    public EmailAddress(@NonNull JSObject data) throws Exception {
        this.isPrimary = data.getBoolean("isPrimary", false);
        this.label = data.getString("label");
        this.type = getTypeFromJSObject(data);
        this.value = getValueFromJSObject(data);
    }

    public static EmailAddress fromJSONObject(JSONObject data) throws Exception {
        return new EmailAddress(JSObject.fromJSONObject(data));
    }

    @Nullable
    public Boolean getIsPrimary() {
        return isPrimary;
    }

    @Nullable
    public String getLabel() {
        return label;
    }

    @NonNull
    public EmailAddressType getType() {
        return type;
    }

    @NonNull
    public String getValue() {
        return value;
    }

    @NonNull
    public JSObject toJSObject() {
        JSObject result = new JSObject();
        result.put("isPrimary", isPrimary);
        result.put("label", label);
        result.put("type", type.toString());
        result.put("value", value);
        return result;
    }

    @NonNull
    private EmailAddressType getTypeFromJSObject(@NonNull JSObject data) throws Exception {
        String typeAsString = data.getString("type");
        if (typeAsString == null) {
            return EmailAddressType.OTHER;
        }
        EmailAddressType type = EmailAddressType.fromString(typeAsString);
        if (type == null) {
            throw new Exception(ContactsPlugin.ERROR_TYPE_INVALID);
        }
        return type;
    }

    @NonNull
    private String getValueFromJSObject(@NonNull JSObject data) throws Exception {
        String value = data.getString("value");
        if (value == null) {
            throw new Exception(ContactsPlugin.ERROR_VALUE_MISSING);
        }
        return value;
    }
}
