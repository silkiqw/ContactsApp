package io.capawesome.capacitorjs.plugins.contacts;

import android.content.ContentProviderOperation;
import android.content.Context;
import android.database.Cursor;
import android.provider.ContactsContract;
import android.util.Base64;
import androidx.annotation.NonNull;
import com.getcapacitor.JSArray;
import com.getcapacitor.PluginCall;
import io.capawesome.capacitorjs.plugins.contacts.classes.Contact;
import io.capawesome.capacitorjs.plugins.contacts.classes.EmailAddress;
import io.capawesome.capacitorjs.plugins.contacts.classes.PhoneNumber;
import io.capawesome.capacitorjs.plugins.contacts.classes.PostalAddress;
import io.capawesome.capacitorjs.plugins.contacts.classes.UrlAddress;
import io.capawesome.capacitorjs.plugins.contacts.enums.ContactField;
import java.util.ArrayList;
import java.util.List;

public class ContactsHelper {

    @NonNull
    public static List<ContactField> getFieldsFromCall(@NonNull PluginCall call) throws Exception {
        JSArray fieldsOptionAsJSArray = call.getArray("fields");

        List<ContactField> fieldsList;
        if (fieldsOptionAsJSArray == null) {
            fieldsList = List.of(
                ContactField.BIRTHDAY,
                ContactField.EMAIL_ADDRESSES,
                ContactField.FAMILY_NAME,
                ContactField.GIVEN_NAME,
                ContactField.ID,
                ContactField.JOB_TITLE,
                ContactField.MIDDLE_NAME,
                ContactField.NAME_PREFIX,
                ContactField.NAME_SUFFIX,
                ContactField.ORGANIZATION_NAME,
                ContactField.PHONE_NUMBERS,
                ContactField.URL_ADDRESSES
            );
        } else {
            fieldsList = new ArrayList<>();
            List<String> fieldsOptionAsList = fieldsOptionAsJSArray.toList();
            for (String key : fieldsOptionAsList) {
                ContactField field = ContactField.fromString(key);
                if (field != null) {
                    fieldsList.add(field);
                }
            }
        }
        return fieldsList;
    }
}
